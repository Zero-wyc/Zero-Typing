import{U as Z,r as c,V as n,a6 as b,X as q,Y as A}from"./index.5a6d529b.js";import{w as D}from"./wordTool.cc85d537.js";import{R as L,T as H}from"./ReloadBtn.cfb1dbd3.js";var l="F:\\Code\\typing-Zero-wyc\\src\\views\\monkey\\Monkey.tsx";const y=32,J=8,h=a=>Array.from(a.children),Q=a=>{const F=c.exports.useRef(null),m=c.exports.useRef(null),P=c.exports.useRef(null),v=c.exports.useRef(D.getWords(a.$state.root.wordsMode,a.$state.root.customerWords)),N=c.exports.useRef([0,0]),u=c.exports.useRef({wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}}),[K,g]=c.exports.useState(!1),[$,k]=c.exports.useState(!1),[O,W]=c.exports.useState(!1),[j,S]=c.exports.useState(!1),[x,B]=c.exports.useState(""),[d,R]=c.exports.useState([]),[T,I]=c.exports.useState({top:0,left:0}),[C,U]=c.exports.useState(30),V=()=>{const r=N.current,t=m.current.getBoundingClientRect(),e=h(m.current)[r[0]];if(!e)return;const s=Array.from(e.getElementsByClassName("letter"));if(s.length<=r[1]){const o=s[r[1]-1].getBoundingClientRect();I({top:o.top-t.top+2,left:o.left-t.left+o.width})}else{const o=s[r[1]].getBoundingClientRect();I({top:o.top-t.top+2,left:o.left-t.left})}},z=c.exports.useCallback((r,t)=>{const e=N.current,s=x===""||x.charAt(x.length-1)===" ";let o;if(r===y)s?o=e:o=[e[0]+1,0];else{if(e[1]>=d[e[0]].letterArr.length){const i=h(m.current)[e[0]],f=document.createElement("code");f.className="letter wrong extra-letter",f.innerText=t,i.appendChild(f)}o=[e[0],e[1]+1]}N.current=o,V(),R(i=>{const f=i[e[0]].letterArr[e[1]];if(f&&r!==y&&(f.isCorrect=t===f.letter,i[e[0]].letterArr[e[1]]=f),r===y&&!s)if(i[e[0]].letterArr.some(p=>p.isCorrect===null))i[e[0]].isSkip=!0,i[e[0]].isCorrect=!1;else{const w=h(m.current)[e[0]].getElementsByClassName("extra-letter");!w||w.length===0?i[e[0]].isCorrect=i[e[0]].letterArr.every(Y=>Y.isCorrect):i[e[0]].isCorrect=!1}return(o[0]>i.length-1||e[0]===i.length-1&&e[1]===i[e[0]].letterArr.length-1)&&(i[e[0]].isCorrect=i[e[0]].letterArr.every(p=>p.isCorrect),u.current.right=i.filter(p=>p.isCorrect).length,u.current.wrong=i.length-u.current.right,u.current.acc=Math.round(u.current.right/(u.current.right+u.current.wrong)*100),u.current.time.secs=Math.round((Date.now()-u.current.time.begin)/1e3),u.current.wpm=(u.current.right/(u.current.time.secs/60)).toFixed(2),g(!1),W(!0),setTimeout(()=>{S(!0)},150)),i}),B(i=>r===y&&(i===""||i.charAt(i.length-1)===" ")?i:i+t)},[x,d]),G=c.exports.useCallback(()=>{const r=x.charAt(x.length-1);if(r==="")return;const t=N.current;let e;if(r===" ")if(d[t[0]-1].isCorrect)e=t;else if(d[t[0]-1].isSkip){const s=d[t[0]-1].letterArr.findIndex(o=>o.isCorrect===null);e=[t[0]-1,s]}else{const o=h(m.current)[t[0]-1].getElementsByClassName("letter");e=[t[0]-1,o.length]}else{const s=h(m.current)[t[0]],o=s.getElementsByClassName("extra-letter");o&&o.length>0&&s.removeChild(o[o.length-1]),e=[t[0],t[1]-1]}N.current=e,V(),R(s=>(r===" "?s[t[0]-1].isCorrect===!1&&(s[t[0]-1].isCorrect=null):s[t[0]].letterArr.length>=t[1]&&(s[t[0]].letterArr[t[1]-1].isCorrect=null,s[t[0]].isCorrect=null),s)),B(s=>{let o=!0;return r===" "&&d[t[0]-1].isCorrect&&(o=!1),o?s.substring(0,s.length-1):s})},[x,d]),X=r=>{r.keyCode!==9&&(r.preventDefault(),r.stopPropagation(),r.persist()),!j&&(k(!1),r.key.length===1?(u.current.time.begin===0&&(u.current.time.begin=Date.now()),z(r.keyCode,r.key)):r.keyCode===J&&G())},M=()=>{g(!0),F.current.focus()},E=c.exports.useCallback(()=>{N.current=[0,0],v.current=D.shuffle(v.current),u.current={wpm:"",right:0,wrong:0,acc:0,time:{begin:0,secs:0}};const r=m.current.getElementsByClassName("extra-letter");r.length!==0&&Array.from(r).forEach(t=>{t.parentNode.removeChild(t)}),R(D.jsonCopy(v.current.slice(0,C)).map(t=>Object.assign({},t,{letterArr:Array.from(t.text).map(e=>({letter:e,isCorrect:null})),isCorrect:null,isSkip:!1}))),B(""),W(!1),S(!1),setTimeout(()=>{M(),V()},10)},[C]);return c.exports.useEffect(()=>{v.current=D.getWords(a.$state.root.wordsMode,a.$state.root.customerWords),E()},[a.$state.root.wordsMode,a.$state.root.customerWords,E,C]),n.exports.jsxDEV("div",{className:"Monkey",children:[n.exports.jsxDEV("div",{className:"word-count-radio",children:n.exports.jsxDEV(b.Group,{value:C,size:"small",onChange:r=>{U(r.target.value)},children:[n.exports.jsxDEV(b.Button,{tabIndex:-1,value:20,children:"20"},void 0,!1,{fileName:l,lineNumber:299,columnNumber:21},void 0),n.exports.jsxDEV(b.Button,{tabIndex:-1,value:30,children:"30"},void 0,!1,{fileName:l,lineNumber:302,columnNumber:21},void 0),n.exports.jsxDEV(b.Button,{tabIndex:-1,value:40,children:"40"},void 0,!1,{fileName:l,lineNumber:305,columnNumber:21},void 0),n.exports.jsxDEV(b.Button,{tabIndex:-1,value:50,children:"50"},void 0,!1,{fileName:l,lineNumber:308,columnNumber:21},void 0)]},void 0,!0,{fileName:l,lineNumber:292,columnNumber:17},void 0)},void 0,!1,{fileName:l,lineNumber:291,columnNumber:13},void 0),n.exports.jsxDEV(q,{justify:"center",align:"middle",children:[n.exports.jsxDEV(A,{flex:"900px",className:`type-main-box ${O?"fading":""} ${j?"hide":""}`,children:[n.exports.jsxDEV("div",{className:`caret ${K?$?"flash":"":"hide"}`,ref:P,style:{transform:`translate3d(${T.left}px,${T.top}px,0)`}},void 0,!1,{fileName:l,lineNumber:320,columnNumber:21},void 0),n.exports.jsxDEV("div",{className:"words-box",onClick:M,ref:m,children:d.map((r,t)=>{var e;return n.exports.jsxDEV("div",{className:`word ${r.isCorrect?"correct":r.isCorrect===!1?"wrong":""}`,children:[n.exports.jsxDEV("div",{className:"label",children:r.label},void 0,!1,{fileName:l,lineNumber:339,columnNumber:33},void 0),(e=r.letterArr)==null?void 0:e.map((s,o)=>n.exports.jsxDEV("code",{className:`letter ${s.isCorrect?"correct":s.isCorrect===!1?"wrong":""}`,children:s.letter},`${t}_${o}`,!1,{fileName:l,lineNumber:341,columnNumber:37},void 0))]},t,!0,{fileName:l,lineNumber:329,columnNumber:29},void 0)})},void 0,!1,{fileName:l,lineNumber:327,columnNumber:21},void 0),n.exports.jsxDEV("input",{className:"hidden-input",type:"text",ref:F,onKeyDown:X,onBlur:()=>{g(!1)},onFocus:()=>{g(!0),k(!0)}},void 0,!1,{fileName:l,lineNumber:357,columnNumber:21},void 0),n.exports.jsxDEV("div",{className:"reload-line",children:n.exports.jsxDEV(L,{onClick:E},void 0,!1,{fileName:l,lineNumber:372,columnNumber:25},void 0)},void 0,!1,{fileName:l,lineNumber:371,columnNumber:21},void 0),n.exports.jsxDEV("div",{className:`tip-line ${$?"":"hide"}`,children:[n.exports.jsxDEV("div",{children:"\u70B9\u51FB\u8BCD\u5757\u8FDB\u5165\u8F93\u5165\u72B6\u6001"},void 0,!1,{fileName:l,lineNumber:376,columnNumber:25},void 0),n.exports.jsxDEV("div",{children:"\u8F93\u5165\u6B63\u786E\u7684\u62FC\u97F3\u5B57\u6BCD\uFF0C\u7136\u540E\u7A7A\u683C"},void 0,!1,{fileName:l,lineNumber:377,columnNumber:25},void 0),n.exports.jsxDEV("div",{children:["\u8F93\u5165\u72B6\u6001\u4E0B",n.exports.jsxDEV("code",{children:"Tab"},void 0,!1,{fileName:l,lineNumber:379,columnNumber:34},void 0),"\u540E\u56DE\u8F66\u53EF\u4EE5\u76F4\u63A5\u5237\u65B0"]},void 0,!0,{fileName:l,lineNumber:378,columnNumber:25},void 0)]},void 0,!0,{fileName:l,lineNumber:375,columnNumber:21},void 0)]},void 0,!0,{fileName:l,lineNumber:314,columnNumber:17},void 0),n.exports.jsxDEV(A,{flex:"900px",className:`type-result-box ${j?"show":""}`,children:[n.exports.jsxDEV(H,{desc:"WPM",numStr:u.current.wpm,acc:u.current.acc,secs:u.current.time.secs},void 0,!1,{fileName:l,lineNumber:385,columnNumber:21},void 0),n.exports.jsxDEV("div",{className:"reload-line",children:n.exports.jsxDEV(L,{onClick:E},void 0,!1,{fileName:l,lineNumber:392,columnNumber:25},void 0)},void 0,!1,{fileName:l,lineNumber:391,columnNumber:21},void 0)]},void 0,!0,{fileName:l,lineNumber:383,columnNumber:17},void 0)]},void 0,!0,{fileName:l,lineNumber:313,columnNumber:13},void 0)]},void 0,!0,{fileName:l,lineNumber:290,columnNumber:9},void 0)};var re=Z(Q);export{re as default};
